{
  "name": "WF5 - ìƒíƒœ ë³€ê²½ ì•Œë¦¼",
  "nodes": [
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "event": "pagedUpdatedInDatabase",
        "databaseId": "0c5ee4b0-26ab-4f0a-9881-5453b072a0cb",
        "simple": false
      },
      "id": "notion-trigger",
      "name": "Notion Trigger: ìƒíƒœ ë³€ê²½",
      "type": "n8n-nodes-base.notionTrigger",
      "typeVersion": 1,
      "position": [220, 300],
      "credentials": {
        "notionApi": {
          "id": "notion-credential-id",
          "name": "Notion API"
        }
      },
      "notes": "Golf Lesson DBì—ì„œ í˜ì´ì§€ ì—…ë°ì´íŠ¸ ê°ì§€\n\nâš ï¸ ì„¤ì •:\n- Event: Page Updated in Database\n- Database: Golf Lesson\n- Poll: Every 5 minutes (ìš´ì˜ ì‹œ)\n- Simplify: OFF"
    },
    {
      "parameters": {
        "jsCode": "// ë³€ê²½ëœ ë ˆìŠ¨ ë°ì´í„° ì²˜ë¦¬\nconst lesson = $input.first().json;\nconst props = lesson.properties;\n\n// ë‚ ì§œ íŒŒì‹±\nconst lessonDateStr = props['ìˆ˜ì—… ë‚ ì§œ']?.date?.start || '';\nconst lessonDate = new Date(lessonDateStr);\n\n// í•œêµ­ì–´ ìš”ì¼\nconst koDays = ['ì¼ìš”ì¼', 'ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼'];\nconst thDays = ['à¸§à¸±à¸™à¸­à¸²à¸—à¸´à¸•à¸¢à¹Œ', 'à¸§à¸±à¸™à¸ˆà¸±à¸™à¸—à¸£à¹Œ', 'à¸§à¸±à¸™à¸­à¸±à¸‡à¸„à¸²à¸£', 'à¸§à¸±à¸™à¸à¸¸à¸˜', 'à¸§à¸±à¸™à¸à¸¤à¸«à¸±à¸ªà¸šà¸”à¸µ', 'à¸§à¸±à¸™à¸¨à¸¸à¸à¸£à¹Œ', 'à¸§à¸±à¸™à¹€à¸ªà¸²à¸£à¹Œ'];\nconst dayOfWeekKo = koDays[lessonDate.getDay()];\nconst dayOfWeekTh = thDays[lessonDate.getDay()];\n\n// ë‚ ì§œ í¬ë§·\nconst formattedDateKo = `${lessonDate.getFullYear()}-${String(lessonDate.getMonth() + 1).padStart(2, '0')}-${String(lessonDate.getDate()).padStart(2, '0')}`;\nconst formattedDateTh = `${String(lessonDate.getDate()).padStart(2, '0')}/${String(lessonDate.getMonth() + 1).padStart(2, '0')}/${lessonDate.getFullYear()}`;\n\n// ì¥ì†Œ\nconst location = props['ìˆ˜ì—… ì¥ì†Œ']?.select?.name || 'í¬íƒˆë¼ì´';\nconst locationTh = location === 'í¬íƒˆë¼ì´' ? 'à¹‚à¸›à¸£à¸—à¸²à¸¥à¸±à¸¢' : location;\n\n// ìƒíƒœ\nconst status = props['ìƒíƒœ']?.select?.name || '';\n\n// íšŒì°¨\nconst session = props['íšŒì°¨ ']?.title?.[0]?.plain_text || '';\n\n// ìƒíƒœë³„ ì²˜ë¦¬\nconst isCancelled = status === 'ì·¨ì†Œ';\nconst isChanged = status === 'ë³€ê²½';\nconst needsNotification = isCancelled || isChanged;\n\nreturn {\n  pageId: lesson.id,\n  session: session,\n  lessonDate: lessonDateStr,\n  formattedDateKo: formattedDateKo,\n  formattedDateTh: formattedDateTh,\n  dayOfWeekKo: dayOfWeekKo,\n  dayOfWeekTh: dayOfWeekTh,\n  location: location,\n  locationTh: locationTh,\n  status: status,\n  isCancelled: isCancelled,\n  isChanged: isChanged,\n  needsNotification: needsNotification\n};"
      },
      "id": "code-process",
      "name": "Code: ìƒíƒœ ë°ì´í„° ì²˜ë¦¬",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [440, 300],
      "notes": "ë³€ê²½ëœ ë ˆìŠ¨ ë°ì´í„° íŒŒì‹±:\n- ìƒíƒœ í™•ì¸ (ì·¨ì†Œ/ë³€ê²½)\n- ë‚ ì§œ/ìš”ì¼ ë³€í™˜\n- ì•Œë¦¼ í•„ìš” ì—¬ë¶€ íŒë‹¨"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "condition-needs-notification",
              "leftValue": "={{ $json.needsNotification }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        }
      },
      "id": "if-needs-notification",
      "name": "IF: ì•Œë¦¼ í•„ìš”?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [660, 300],
      "notes": "ìƒíƒœê°€ 'ì·¨ì†Œ' ë˜ëŠ” 'ë³€ê²½'ì¼ ë•Œë§Œ ì•Œë¦¼ ë°œì†¡"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "condition-cancelled",
              "leftValue": "={{ $json.isCancelled }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        }
      },
      "id": "if-cancelled",
      "name": "IF: ì·¨ì†Œ?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [880, 200],
      "notes": "ì·¨ì†Œ vs ë³€ê²½ ë¶„ê¸°"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/push",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "lineNotifyApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ {\n  \"to\": \"U2168511c9cf9d66bb6cb0043f818bb1c\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\nâŒ ì´ë²ˆì£¼ ë ˆìŠ¨ ì·¨ì†Œ\\n\\nğŸ“… \" + $json.dayOfWeekKo + \" (\" + $json.formattedDateKo + \")\\në ˆìŠ¨ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.\\n\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\nâŒ à¸¢à¸à¹€à¸¥à¸´à¸à¹€à¸£à¸µà¸¢à¸™à¸à¸­à¸¥à¹Œà¸Ÿà¸ªà¸±à¸›à¸”à¸²à¸«à¹Œà¸™à¸µà¹‰\\n\\nğŸ“… \" + $json.dayOfWeekTh + \" (\" + $json.formattedDateTh + \")\\nà¸¢à¸à¹€à¸¥à¸´à¸à¹à¸¥à¹‰à¸§\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"\n    }\n  ]\n} }}"
      },
      "id": "line-family-cancel",
      "name": "Line: ê°€ì¡±ê·¸ë£¹ ì·¨ì†Œ ì•Œë¦¼",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1100, 100],
      "credentials": {
        "httpHeaderAuth": {
          "id": "line-auth-id",
          "name": "Line Bot Auth"
        }
      },
      "notes": "ê°€ì¡±ê·¸ë£¹ì— ì·¨ì†Œ ì•Œë¦¼ (í•œêµ­ì–´+íƒœêµ­ì–´)\n\nâš ï¸ í…ŒìŠ¤íŠ¸: Dylan ID\nìš´ì˜: ê°€ì¡±ê·¸ë£¹ ID (C20b8ad1ae43e07dcb067f6f38349b602)"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/push",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "lineNotifyApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ {\n  \"to\": \"U2168511c9cf9d66bb6cb0043f818bb1c\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\nâŒ ë ˆìŠ¨ ì·¨ì†Œ ì•ˆë‚´\\n\\nğŸ“… \" + $json.dayOfWeekKo + \" (\" + $json.formattedDateKo + \")\\në ˆìŠ¨ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.\\n\\nì£„ì†¡í•©ë‹ˆë‹¤ ğŸ™\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"\n    }\n  ]\n} }}"
      },
      "id": "line-kimpro-cancel",
      "name": "Line: ê¹€í”„ë¡œ ì·¨ì†Œ ì•Œë¦¼",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1320, 100],
      "credentials": {
        "httpHeaderAuth": {
          "id": "line-auth-id",
          "name": "Line Bot Auth"
        }
      },
      "notes": "ê¹€í”„ë¡œì—ê²Œ ì·¨ì†Œ ì•Œë¦¼\n\nâš ï¸ í…ŒìŠ¤íŠ¸: Dylan ID\nìš´ì˜: ê¹€í”„ë¡œ ID (Ub46e21fd3af428c831ffe3a1d3c23128)"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/push",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "lineNotifyApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ {\n  \"to\": \"U2168511c9cf9d66bb6cb0043f818bb1c\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\nğŸ”„ ë ˆìŠ¨ ì¼ì • ë³€ê²½\\n\\nğŸ“… \" + $json.dayOfWeekKo + \" (\" + $json.formattedDateKo + \")\\nğŸ“ \" + $json.location + \"\\n\\nì¼ì •ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.\\nìì„¸í•œ ë‚´ìš©ì€ ë…¸ì…˜ì„ í™•ì¸í•´ì£¼ì„¸ìš”.\\n\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\nğŸ”„ à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹à¸›à¸¥à¸‡à¸•à¸²à¸£à¸²à¸‡à¹€à¸£à¸µà¸¢à¸™\\n\\nğŸ“… \" + $json.dayOfWeekTh + \" (\" + $json.formattedDateTh + \")\\nğŸ“ \" + $json.locationTh + \"\\n\\nà¸•à¸²à¸£à¸²à¸‡à¹€à¸£à¸µà¸¢à¸™à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹à¸›à¸¥à¸‡\\nà¸à¸£à¸¸à¸“à¸²à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹ƒà¸™ Notion\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"\n    }\n  ]\n} }}"
      },
      "id": "line-family-change",
      "name": "Line: ê°€ì¡±ê·¸ë£¹ ë³€ê²½ ì•Œë¦¼",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1100, 300],
      "credentials": {
        "httpHeaderAuth": {
          "id": "line-auth-id",
          "name": "Line Bot Auth"
        }
      },
      "notes": "ê°€ì¡±ê·¸ë£¹ì— ë³€ê²½ ì•Œë¦¼ (í•œêµ­ì–´+íƒœêµ­ì–´)\n\nâš ï¸ í…ŒìŠ¤íŠ¸: Dylan ID\nìš´ì˜: ê°€ì¡±ê·¸ë£¹ ID (C20b8ad1ae43e07dcb067f6f38349b602)"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/push",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "lineNotifyApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ {\n  \"to\": \"U2168511c9cf9d66bb6cb0043f818bb1c\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\nğŸ”„ ë ˆìŠ¨ ì¼ì • ë³€ê²½ ì•ˆë‚´\\n\\nğŸ“… \" + $json.dayOfWeekKo + \" (\" + $json.formattedDateKo + \")\\nğŸ“ \" + $json.location + \"\\n\\nì¼ì •ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.\\n\\ní™•ì¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤ ğŸ™\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"\n    }\n  ]\n} }}"
      },
      "id": "line-kimpro-change",
      "name": "Line: ê¹€í”„ë¡œ ë³€ê²½ ì•Œë¦¼",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1320, 300],
      "credentials": {
        "httpHeaderAuth": {
          "id": "line-auth-id",
          "name": "Line Bot Auth"
        }
      },
      "notes": "ê¹€í”„ë¡œì—ê²Œ ë³€ê²½ ì•Œë¦¼\n\nâš ï¸ í…ŒìŠ¤íŠ¸: Dylan ID\nìš´ì˜: ê¹€í”„ë¡œ ID (Ub46e21fd3af428c831ffe3a1d3c23128)"
    },
    {
      "parameters": {},
      "id": "no-op",
      "name": "No Operation: ìŠ¤í‚µ",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [880, 500],
      "notes": "ìƒíƒœê°€ 'ì •ìƒ'ì¼ ë•ŒëŠ” ì•Œë¦¼ ë°œì†¡í•˜ì§€ ì•ŠìŒ"
    }
  ],
  "connections": {
    "Notion Trigger: ìƒíƒœ ë³€ê²½": {
      "main": [
        [
          {
            "node": "Code: ìƒíƒœ ë°ì´í„° ì²˜ë¦¬",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code: ìƒíƒœ ë°ì´í„° ì²˜ë¦¬": {
      "main": [
        [
          {
            "node": "IF: ì•Œë¦¼ í•„ìš”?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF: ì•Œë¦¼ í•„ìš”?": {
      "main": [
        [
          {
            "node": "IF: ì·¨ì†Œ?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation: ìŠ¤í‚µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF: ì·¨ì†Œ?": {
      "main": [
        [
          {
            "node": "Line: ê°€ì¡±ê·¸ë£¹ ì·¨ì†Œ ì•Œë¦¼",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Line: ê°€ì¡±ê·¸ë£¹ ë³€ê²½ ì•Œë¦¼",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Line: ê°€ì¡±ê·¸ë£¹ ì·¨ì†Œ ì•Œë¦¼": {
      "main": [
        [
          {
            "node": "Line: ê¹€í”„ë¡œ ì·¨ì†Œ ì•Œë¦¼",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Line: ê°€ì¡±ê·¸ë£¹ ë³€ê²½ ì•Œë¦¼": {
      "main": [
        [
          {
            "node": "Line: ê¹€í”„ë¡œ ë³€ê²½ ì•Œë¦¼",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "timezone": "Asia/Bangkok"
  },
  "tags": [
    {
      "name": "Golf Family"
    }
  ]
}
