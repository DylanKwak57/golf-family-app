{
  "name": "WF4 - Dylan ì›í´ë¦­ íƒ€ì„",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 16,
              "triggerAtMinute": 30
            }
          ]
        }
      },
      "id": "schedule-trigger",
      "name": "Schedule: ëª©ìš”ì¼ 16:30",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [220, 300],
      "notes": "ë§¤ì£¼ ëª©ìš”ì¼ 16:30 (ë°©ì½•ì‹œê°„)\në ˆìŠ¨ 30ë¶„ ì „\n\nâš ï¸ ì„¤ì • í•„ìš”:\n- Mode: Every Week\n- Weekday: Thursday\n- Hour: 16\n- Minute: 30\n- Timezone: Asia/Bangkok"
    },
    {
      "parameters": {
        "operation": "getAll",
        "databaseId": "0c5ee4b0-26ab-4f0a-9881-5453b072a0cb",
        "returnAll": false,
        "limit": 1,
        "filterType": "none",
        "sort": {
          "sortValue": [
            {
              "key": "ìˆ˜ì—… ë‚ ì§œ",
              "type": "timestamp",
              "direction": "descending"
            }
          ]
        },
        "options": {}
      },
      "id": "notion-get-lesson",
      "name": "Notion: ì˜¤ëŠ˜ ë ˆìŠ¨ ì¡°íšŒ",
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [440, 300],
      "credentials": {
        "notionApi": {
          "id": "notion-credential-id",
          "name": "Notion API"
        }
      },
      "notes": "ìµœì‹  ë ˆìŠ¨ í˜ì´ì§€ 1ê°œ ì¡°íšŒ\n\nì„¤ì •:\n- Database: Golf Lesson\n- Return All: OFF\n- Limit: 1\n- Sort: ìˆ˜ì—… ë‚ ì§œ Descending\n- Simplify: OFF"
    },
    {
      "parameters": {
        "jsCode": "// ì˜¤ëŠ˜ ë ˆìŠ¨ ë°ì´í„° ì²˜ë¦¬\nconst lesson = $input.first().json;\nconst props = lesson.properties;\n\n// ì¥ì†Œ\nconst location = props['ìˆ˜ì—… ì¥ì†Œ']?.select?.name || 'í¬íƒˆë¼ì´';\n\n// ìƒíƒœ í™•ì¸\nconst status = props['ìƒíƒœ']?.select?.name || 'ì •ìƒ';\n\n// íƒ€ì„ ë²ˆí˜¸\nconst bayNumber = props['íƒ€ì„ ë²ˆí˜¸']?.rich_text?.[0]?.plain_text || '';\n\n// íšŒì°¨\nconst session = props['íšŒì°¨ ']?.title?.[0]?.plain_text || '';\n\n// Webhook URL for one-click\nconst webhookUrl = 'https://dylan-automation.app.n8n.cloud/webhook/golf-send-bay?session=' + session + '&bay=' + encodeURIComponent(bayNumber);\n\nreturn {\n  pageId: lesson.id,\n  session: session,\n  location: location,\n  status: status,\n  bayNumber: bayNumber,\n  hasBayNumber: bayNumber.length > 0,\n  isNormal: status === 'ì •ìƒ',\n  webhookUrl: webhookUrl\n};"
      },
      "id": "code-process",
      "name": "Code: ë ˆìŠ¨ ë°ì´í„° ì²˜ë¦¬",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [660, 300],
      "notes": "ë ˆìŠ¨ ë°ì´í„° íŒŒì‹±:\n- ìƒíƒœ í™•ì¸\n- íƒ€ì„ ë²ˆí˜¸ í™•ì¸\n- Webhook URL ìƒì„±"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "condition-normal",
              "leftValue": "={{ $json.isNormal }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            },
            {
              "id": "condition-has-bay",
              "leftValue": "={{ $json.hasBayNumber }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        }
      },
      "id": "if-check",
      "name": "IF: ì •ìƒ & íƒ€ì„ ìˆìŒ",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [880, 300],
      "notes": "ì¡°ê±´ í™•ì¸:\n1. ìƒíƒœ = ì •ìƒ\n2. íƒ€ì„ ë²ˆí˜¸ê°€ ìˆìŒ\n\në‘˜ ë‹¤ ë§Œì¡±í•´ì•¼ Dylanì—ê²Œ ì›í´ë¦­ ë°œì†¡"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/push",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "lineNotifyApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ {\n  \"to\": \"U2168511c9cf9d66bb6cb0043f818bb1c\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\nğŸŒï¸ ë ˆìŠ¨ 30ë¶„ ì „!\\n\\nğŸ“ \" + $json.location + \"\\nğŸ¯ íƒ€ì„: \" + $json.bayNumber + \"\\n\\nğŸ‘‡ íƒ€ì„ í™•ì¸ & ê¹€í”„ë¡œ ì „ì†¡\\nhttps://dylankwak57.github.io/golf-family-app/family.html\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"\n    }\n  ]\n} }}"
      },
      "id": "line-dylan",
      "name": "Line: Dylan ì›í´ë¦­",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1100, 200],
      "credentials": {
        "httpHeaderAuth": {
          "id": "line-auth-id",
          "name": "Line Bot Auth"
        }
      },
      "notes": "Dylanì—ê²Œ ì›í´ë¦­ íƒ€ì„ ì•Œë¦¼ ë°œì†¡\n\në§í¬ í´ë¦­ ì‹œ â†’ WF4-Webhookìœ¼ë¡œ ì—°ê²°\nâ†’ ê¹€í”„ë¡œì—ê²Œ íƒ€ì„ ì•Œë¦¼ ìë™ ë°œì†¡"
    },
    {
      "parameters": {},
      "id": "no-op",
      "name": "No Operation: ìŠ¤í‚µ",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [1100, 400],
      "notes": "ì¡°ê±´ ë¯¸ì¶©ì¡± ì‹œ:\n- ìƒíƒœê°€ 'ì •ìƒ'ì´ ì•„ë‹˜\n- ë˜ëŠ” íƒ€ì„ ë²ˆí˜¸ê°€ ì—†ìŒ\n\nâ†’ ì›í´ë¦­ ë°œì†¡í•˜ì§€ ì•ŠìŒ"
    }
  ],
  "connections": {
    "Schedule: ëª©ìš”ì¼ 16:30": {
      "main": [
        [
          {
            "node": "Notion: ì˜¤ëŠ˜ ë ˆìŠ¨ ì¡°íšŒ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notion: ì˜¤ëŠ˜ ë ˆìŠ¨ ì¡°íšŒ": {
      "main": [
        [
          {
            "node": "Code: ë ˆìŠ¨ ë°ì´í„° ì²˜ë¦¬",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code: ë ˆìŠ¨ ë°ì´í„° ì²˜ë¦¬": {
      "main": [
        [
          {
            "node": "IF: ì •ìƒ & íƒ€ì„ ìˆìŒ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF: ì •ìƒ & íƒ€ì„ ìˆìŒ": {
      "main": [
        [
          {
            "node": "Line: Dylan ì›í´ë¦­",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation: ìŠ¤í‚µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "timezone": "Asia/Bangkok"
  },
  "tags": [
    {
      "name": "Golf Family"
    }
  ]
}
