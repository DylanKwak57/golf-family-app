{
  "name": "WF4-Webhook - íƒ€ì„ ì „ì†¡ (ê¹€í”„ë¡œ)",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "golf-send-bay",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-trigger",
      "name": "Webhook: íƒ€ì„ ì „ì†¡",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [220, 300],
      "webhookId": "golf-send-bay",
      "notes": "ì›¹ì•±ì—ì„œ 'ê¹€í”„ë¡œì—ê²Œ ì „ì†¡' ë²„íŠ¼ í´ë¦­ ì‹œ íŠ¸ë¦¬ê±°\n\nURL: https://dylan-automation.app.n8n.cloud/webhook/golf-send-bay\n\nBody:\n- bayNumber: íƒ€ì„ ë²ˆí˜¸"
    },
    {
      "parameters": {
        "operation": "getAll",
        "databaseId": "0c5ee4b0-26ab-4f0a-9881-5453b072a0cb",
        "returnAll": false,
        "limit": 1,
        "filterType": "none",
        "sort": {
          "sortValue": [
            {
              "key": "ìˆ˜ì—… ë‚ ì§œ",
              "type": "timestamp",
              "direction": "descending"
            }
          ]
        },
        "options": {}
      },
      "id": "notion-get-lesson",
      "name": "Notion: ìµœì‹  ë ˆìŠ¨ ì¡°íšŒ",
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [440, 300],
      "credentials": {
        "notionApi": {
          "id": "notion-credential-id",
          "name": "Notion API"
        }
      },
      "notes": "ìµœì‹  ë ˆìŠ¨ í˜ì´ì§€ì—ì„œ íƒ€ì„ ë²ˆí˜¸ ì¡°íšŒ\n\nì„¤ì •:\n- Database: Golf Lesson\n- Limit: 1\n- Sort: ìˆ˜ì—… ë‚ ì§œ Descending\n- Simplify: OFF"
    },
    {
      "parameters": {
        "jsCode": "// Webhookì—ì„œ ë°›ì€ íƒ€ì„ ë²ˆí˜¸ ë˜ëŠ” Notionì—ì„œ ì¡°íšŒí•œ íƒ€ì„ ë²ˆí˜¸ ì‚¬ìš©\nconst webhookData = $('Webhook: íƒ€ì„ ì „ì†¡').first().json;\nconst notionData = $input.first().json;\n\n// Webhookì—ì„œ ë°›ì€ íƒ€ì„ ë²ˆí˜¸ (ì›¹ì•±ì—ì„œ ì „ì†¡)\nconst webhookBay = webhookData.body?.bayNumber || '';\n\n// Notionì—ì„œ ì¡°íšŒí•œ íƒ€ì„ ë²ˆí˜¸\nconst props = notionData.properties;\nconst notionBay = props['íƒ€ì„ ë²ˆí˜¸']?.rich_text?.[0]?.plain_text || '';\n\n// ì›¹ì•±ì—ì„œ ë³´ë‚¸ ê°’ ìš°ì„ , ì—†ìœ¼ë©´ Notion ê°’ ì‚¬ìš©\nconst bayNumber = webhookBay || notionBay;\n\n// íšŒì°¨\nconst session = props['íšŒì°¨ ']?.title?.[0]?.plain_text || '';\n\n// ì¥ì†Œ\nconst location = props['ìˆ˜ì—… ì¥ì†Œ']?.select?.name || 'í¬íƒˆë¼ì´';\n\nreturn {\n  bayNumber: bayNumber,\n  session: session,\n  location: location,\n  hasBayNumber: bayNumber.length > 0\n};"
      },
      "id": "code-extract",
      "name": "Code: íƒ€ì„ ë²ˆí˜¸ í™•ì¸",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [660, 300],
      "notes": "ì›¹ì•±ì—ì„œ ë°›ì€ íƒ€ì„ ë²ˆí˜¸ ë˜ëŠ” Notion ìµœì‹  íƒ€ì„ ë²ˆí˜¸ ì‚¬ìš©"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "condition-has-bay",
              "leftValue": "={{ $json.hasBayNumber }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        }
      },
      "id": "if-check",
      "name": "IF: íƒ€ì„ ìˆìŒ?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [880, 300],
      "notes": "íƒ€ì„ ë²ˆí˜¸ê°€ ìˆì„ ë•Œë§Œ ê¹€í”„ë¡œì—ê²Œ ì „ì†¡"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/push",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "lineNotifyApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ {\n  \"to\": \"U2168511c9cf9d66bb6cb0043f818bb1c\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\nğŸŒï¸ ê³¨í”„ ë ˆìŠ¨ íƒ€ì„ ì•ˆë‚´\\n\\nğŸ“ \" + $json.location + \"\\nğŸ¯ íƒ€ì„: \" + $json.bayNumber + \"\\n\\nê³§ ëµ™ê² ìŠµë‹ˆë‹¤! ğŸ™\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"\n    }\n  ]\n} }}"
      },
      "id": "line-kimpro",
      "name": "Line: ê¹€í”„ë¡œ íƒ€ì„ ì•Œë¦¼",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1100, 200],
      "credentials": {
        "httpHeaderAuth": {
          "id": "line-auth-id",
          "name": "Line Bot Auth"
        }
      },
      "notes": "ê¹€í”„ë¡œì—ê²Œ íƒ€ì„ ì•Œë¦¼ ë°œì†¡\n\nâš ï¸ í…ŒìŠ¤íŠ¸ ì‹œ toë¥¼ Dylan IDë¡œ ìœ ì§€:\nU2168511c9cf9d66bb6cb0043f818bb1c\n\nìš´ì˜ ì‹œ ë³µì›:\nUb46e21fd3af428c831ffe3a1d3c23128"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { \"success\": true, \"message\": \"ê¹€í”„ë¡œì—ê²Œ ì „ì†¡ ì™„ë£Œ!\", \"bayNumber\": $json.bayNumber } }}"
      },
      "id": "respond-success",
      "name": "Respond: ì „ì†¡ ì™„ë£Œ",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [1320, 200],
      "notes": "ì›¹ì•±ì— ì „ì†¡ ì™„ë£Œ ì‘ë‹µ"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { \"success\": false, \"message\": \"íƒ€ì„ ë²ˆí˜¸ê°€ ì—†ìŠµë‹ˆë‹¤\" } }}",
        "options": {
          "responseCode": 400
        }
      },
      "id": "respond-error",
      "name": "Respond: ì—ëŸ¬",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [1100, 400],
      "notes": "íƒ€ì„ ë²ˆí˜¸ ì—†ì„ ë•Œ ì—ëŸ¬ ì‘ë‹µ"
    }
  ],
  "connections": {
    "Webhook: íƒ€ì„ ì „ì†¡": {
      "main": [
        [
          {
            "node": "Notion: ìµœì‹  ë ˆìŠ¨ ì¡°íšŒ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notion: ìµœì‹  ë ˆìŠ¨ ì¡°íšŒ": {
      "main": [
        [
          {
            "node": "Code: íƒ€ì„ ë²ˆí˜¸ í™•ì¸",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code: íƒ€ì„ ë²ˆí˜¸ í™•ì¸": {
      "main": [
        [
          {
            "node": "IF: íƒ€ì„ ìˆìŒ?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF: íƒ€ì„ ìˆìŒ?": {
      "main": [
        [
          {
            "node": "Line: ê¹€í”„ë¡œ íƒ€ì„ ì•Œë¦¼",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Respond: ì—ëŸ¬",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Line: ê¹€í”„ë¡œ íƒ€ì„ ì•Œë¦¼": {
      "main": [
        [
          {
            "node": "Respond: ì „ì†¡ ì™„ë£Œ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "timezone": "Asia/Bangkok"
  },
  "tags": [
    {
      "name": "Golf Family"
    }
  ]
}
