{
  "name": "WF2 - Aeey íƒ€ì„ ë¦¬ë§ˆì¸ë”",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 17,
              "triggerAtMinute": 0
            }
          ]
        }
      },
      "id": "schedule-trigger",
      "name": "Schedule: í™”ìš”ì¼ 17ì‹œ",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [220, 300],
      "notes": "ë§¤ì£¼ í™”ìš”ì¼ 17:00 (ë°©ì½•ì‹œê°„)\n\nâš ï¸ ì„¤ì • í•„ìš”:\n- Mode: Every Week\n- Weekday: Tuesday\n- Hour: 17\n- Minute: 0\n- Timezone: Asia/Bangkok"
    },
    {
      "parameters": {
        "operation": "getAll",
        "databaseId": "0c5ee4b0-26ab-4f0a-9881-5453b072a0cb",
        "returnAll": false,
        "limit": 1,
        "filterType": "none",
        "sort": {
          "sortValue": [
            {
              "key": "ìˆ˜ì—… ë‚ ì§œ",
              "type": "timestamp",
              "direction": "descending"
            }
          ]
        }
      },
      "id": "notion-get-lesson",
      "name": "Notion: ì´ë²ˆì£¼ ë ˆìŠ¨ ì¡°íšŒ",
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [440, 300],
      "credentials": {
        "notionApi": {
          "id": "notion-credential-id",
          "name": "Notion API"
        }
      },
      "notes": "ìµœì‹  ë ˆìŠ¨ í˜ì´ì§€ 1ê°œ ì¡°íšŒ\n\ní•„í„° (ì„ íƒì‚¬í•­):\n- ìƒíƒœ = ì •ìƒ\n- ìˆ˜ì—… ë‚ ì§œê°€ ì´ë²ˆì£¼"
    },
    {
      "parameters": {
        "jsCode": "// ì´ë²ˆì£¼ ë ˆìŠ¨ ë°ì´í„° ì²˜ë¦¬\nconst lesson = $input.first().json;\nconst props = lesson.properties;\n\n// ë‚ ì§œ íŒŒì‹±\nconst lessonDateStr = props['ìˆ˜ì—… ë‚ ì§œ']?.date?.start || '';\nconst lessonDate = new Date(lessonDateStr);\n\n// íƒœêµ­ì–´ ìš”ì¼ ë³€í™˜\nconst thaiDays = ['à¸§à¸±à¸™à¸­à¸²à¸—à¸´à¸•à¸¢à¹Œ', 'à¸§à¸±à¸™à¸ˆà¸±à¸™à¸—à¸£à¹Œ', 'à¸§à¸±à¸™à¸­à¸±à¸‡à¸„à¸²à¸£', 'à¸§à¸±à¸™à¸à¸¸à¸˜', 'à¸§à¸±à¸™à¸à¸¤à¸«à¸±à¸ªà¸šà¸”à¸µ', 'à¸§à¸±à¸™à¸¨à¸¸à¸à¸£à¹Œ', 'à¸§à¸±à¸™à¹€à¸ªà¸²à¸£à¹Œ'];\nconst dayOfWeek = thaiDays[lessonDate.getDay()];\n\n// ë‚ ì§œ í¬ë§· (DD/MM/YYYY)\nconst formattedDate = `${String(lessonDate.getDate()).padStart(2, '0')}/${String(lessonDate.getMonth() + 1).padStart(2, '0')}/${lessonDate.getFullYear()}`;\n\n// ì¥ì†Œ (íƒœêµ­ì–´ ë³€í™˜)\nconst location = props['ìˆ˜ì—… ì¥ì†Œ']?.select?.name || 'í¬íƒˆë¼ì´';\nconst locationTh = location === 'í¬íƒˆë¼ì´' ? 'à¹‚à¸›à¸£à¸—à¸²à¸¥à¸±à¸¢' : location;\n\n// ìƒíƒœ í™•ì¸\nconst status = props['ìƒíƒœ']?.select?.name || 'ì •ìƒ';\n\n// íƒ€ì„ ë²ˆí˜¸ í™•ì¸\nconst bayNumber = props['Bay Number']?.rich_text?.[0]?.plain_text || '';\n\n// íšŒì°¨\nconst session = props['íšŒì°¨ ']?.title?.[0]?.plain_text || '';\n\nreturn {\n  pageId: lesson.id,\n  session: session,\n  lessonDate: lessonDateStr,\n  formattedDate: formattedDate,\n  dayOfWeek: dayOfWeek,\n  location: location,\n  locationTh: locationTh,\n  status: status,\n  bayNumber: bayNumber,\n  hasBayNumber: bayNumber.length > 0,\n  isNormal: status === 'ì •ìƒ'\n};"
      },
      "id": "code-process",
      "name": "Code: ë ˆìŠ¨ ë°ì´í„° ì²˜ë¦¬",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [660, 300],
      "notes": "ë ˆìŠ¨ ë°ì´í„° íŒŒì‹±:\n- íƒœêµ­ì–´ ìš”ì¼ ë³€í™˜\n- ìƒíƒœ í™•ì¸\n- íƒ€ì„ ë²ˆí˜¸ ìœ ë¬´ í™•ì¸"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "condition-normal",
              "leftValue": "={{ $json.isNormal }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            },
            {
              "id": "condition-no-bay",
              "leftValue": "={{ $json.hasBayNumber }}",
              "rightValue": false,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        }
      },
      "id": "if-check",
      "name": "IF: ì •ìƒ & íƒ€ì„ ì—†ìŒ",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [880, 300],
      "notes": "ì¡°ê±´ í™•ì¸:\n1. ìƒíƒœ = ì •ìƒ\n2. íƒ€ì„ ë²ˆí˜¸ê°€ ë¹„ì–´ìˆìŒ\n\në‘˜ ë‹¤ ë§Œì¡±í•´ì•¼ Aeeyì—ê²Œ ë¦¬ë§ˆì¸ë“œ"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/push",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "lineNotifyApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ {\n  \"to\": \"U1cb692b2a80455574c43cdc776e88250\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\nğŸ¯ à¸ˆà¸­à¸‡à¸«à¸¡à¸²à¸¢à¹€à¸¥à¸‚ Bay\\n\\nğŸ“… \" + $json.dayOfWeek + \" (\" + $json.formattedDate + \")\\nâ° 17:00 - 19:00\\nğŸ“ \" + $json.locationTh + \"\\n\\nà¸à¸£à¸¸à¸“à¸²à¸ˆà¸­à¸‡ Bay à¹à¸¥à¹‰à¸§à¸à¸£à¸­à¸à¸«à¸¡à¸²à¸¢à¹€à¸¥à¸‚:\\nğŸ‘‰ https://dylankwak57.github.io/golf-family-app/family.html?lang=th\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"\n    }\n  ]\n} }}"
      },
      "id": "line-aeey",
      "name": "Line: Aeey ë¦¬ë§ˆì¸ë“œ",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1100, 200],
      "credentials": {
        "httpHeaderAuth": {
          "id": "line-auth-id",
          "name": "Line Bot Auth"
        }
      },
      "notes": "Aeeyì—ê²Œ íƒ€ì„ ì˜ˆì•½ ë¦¬ë§ˆì¸ë“œ ë°œì†¡ (íƒœêµ­ì–´)\n\nâš ï¸ ì„¤ì • í•„ìš”:\nAuthentication: Header Auth\n- Name: Authorization\n- Value: Bearer {LINE_CHANNEL_ACCESS_TOKEN}"
    },
    {
      "parameters": {},
      "id": "no-op",
      "name": "No Operation: ìŠ¤í‚µ",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [1100, 400],
      "notes": "ì¡°ê±´ ë¯¸ì¶©ì¡± ì‹œ:\n- ìƒíƒœê°€ 'ì •ìƒ'ì´ ì•„ë‹˜\n- ë˜ëŠ” ì´ë¯¸ íƒ€ì„ ë²ˆí˜¸ê°€ ì…ë ¥ë¨\n\nâ†’ ë¦¬ë§ˆì¸ë“œ ë°œì†¡í•˜ì§€ ì•ŠìŒ"
    }
  ],
  "connections": {
    "Schedule: í™”ìš”ì¼ 17ì‹œ": {
      "main": [
        [
          {
            "node": "Notion: ì´ë²ˆì£¼ ë ˆìŠ¨ ì¡°íšŒ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notion: ì´ë²ˆì£¼ ë ˆìŠ¨ ì¡°íšŒ": {
      "main": [
        [
          {
            "node": "Code: ë ˆìŠ¨ ë°ì´í„° ì²˜ë¦¬",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code: ë ˆìŠ¨ ë°ì´í„° ì²˜ë¦¬": {
      "main": [
        [
          {
            "node": "IF: ì •ìƒ & íƒ€ì„ ì—†ìŒ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF: ì •ìƒ & íƒ€ì„ ì—†ìŒ": {
      "main": [
        [
          {
            "node": "Line: Aeey ë¦¬ë§ˆì¸ë“œ",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation: ìŠ¤í‚µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "timezone": "Asia/Bangkok"
  },
  "tags": [
    {
      "name": "Golf Family"
    }
  ]
}
