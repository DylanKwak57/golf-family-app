{
  "name": "Golf WF1 - Lesson Page Creation",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "weeks",
              "triggerAtDay": [1],
              "triggerAtHour": 11,
              "triggerAtMinute": 0
            }
          ]
        }
      },
      "id": "schedule-trigger",
      "name": "Schedule: ì›”ìš”ì¼ 11ì‹œ",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [240, 300]
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "getAll",
        "databaseId": {
          "__rl": true,
          "value": "0c5ee4b0-26ab-4f0a-9881-5453b072a0cb",
          "mode": "id"
        },
        "returnAll": false,
        "limit": 1,
        "sort": {
          "sortValue": [
            {
              "key": "ë ˆìŠ¨ íšŒì°¨|number",
              "type": "descending"
            }
          ]
        },
        "options": {}
      },
      "id": "notion-get-latest",
      "name": "Notion: ìµœì‹  ë ˆìŠ¨ ì¡°íšŒ",
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [460, 300],
      "credentials": {
        "notionApi": {
          "id": "YOUR_NOTION_CREDENTIAL_ID",
          "name": "Notion API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ìµœì‹  ë ˆìŠ¨ ë°ì´í„°ì—ì„œ ë‹¤ìŒ íšŒì°¨ ê³„ì‚°\nconst latestLesson = $input.first().json;\n\n// í˜„ì¬ íšŒì°¨ ê°€ì ¸ì˜¤ê¸°\nconst currentSession = latestLesson.properties['ë ˆìŠ¨ íšŒì°¨']?.number || 106;\nconst nextSession = currentSession + 1;\n\n// ë‹¤ìŒ ëª©ìš”ì¼ ê³„ì‚°\nconst today = new Date();\nconst dayOfWeek = today.getDay();\nconst daysUntilThursday = (4 - dayOfWeek + 7) % 7 || 7; // ë‹¤ìŒ ëª©ìš”ì¼\nconst nextThursday = new Date(today);\nnextThursday.setDate(today.getDate() + daysUntilThursday);\n\n// ISO ë‚ ì§œ í˜•ì‹\nconst lessonDate = nextThursday.toISOString().split('T')[0];\n\nreturn {\n  nextSession: nextSession,\n  lessonDate: lessonDate,\n  lessonTime: \"17:00\",\n  location: \"í¬íƒˆë¼ì´\",\n  status: \"ì •ìƒ\",\n  lessonType: \"ì¼ë°˜\"\n};"
      },
      "id": "code-calculate",
      "name": "Code: ë‹¤ìŒ íšŒì°¨ ê³„ì‚°",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [680, 300]
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "create",
        "databaseId": {
          "__rl": true,
          "value": "0c5ee4b0-26ab-4f0a-9881-5453b072a0cb",
          "mode": "id"
        },
        "properties": {
          "propertyValues": [
            {
              "key": "ë ˆìŠ¨ íšŒì°¨|number",
              "numberValue": "={{ $json.nextSession }}"
            },
            {
              "key": "ë ˆìŠ¨ ë‚ ì§œ|date",
              "dateValue": "={{ $json.lessonDate }}"
            },
            {
              "key": "ë ˆìŠ¨ ì‹œê°„|rich_text",
              "textValue": "={{ $json.lessonTime }}"
            },
            {
              "key": "ì¥ì†Œ|select",
              "selectValue": "={{ $json.location }}"
            },
            {
              "key": "ìƒíƒœ|select",
              "selectValue": "={{ $json.status }}"
            },
            {
              "key": "ë ˆìŠ¨ íƒ€ì…|select",
              "selectValue": "={{ $json.lessonType }}"
            }
          ]
        },
        "options": {}
      },
      "id": "notion-create-page",
      "name": "Notion: ìƒˆ ë ˆìŠ¨ í˜ì´ì§€ ìƒì„±",
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [900, 300],
      "credentials": {
        "notionApi": {
          "id": "YOUR_NOTION_CREDENTIAL_ID",
          "name": "Notion API"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/push",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ {\n  \"to\": \"C20b8ad1ae43e07dcb067f6f38349b602\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"ğŸŒï¸ \" + $json.nextSession + \"íšŒì°¨ ë ˆìŠ¨ í˜ì´ì§€ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!\\n\\nğŸ“… \" + $json.lessonDate + \" (ëª©)\\nâ° 17:00 - 19:00\\nğŸ“ í¬íƒˆë¼ì´\\n\\nğŸ‡¹ğŸ‡­ à¸ªà¸£à¹‰à¸²à¸‡à¸«à¸™à¹‰à¸²à¸šà¸—à¹€à¸£à¸µà¸¢à¸™à¸„à¸£à¸±à¹‰à¸‡à¸—à¸µà¹ˆ \" + $json.nextSession + \" à¹à¸¥à¹‰à¸§!\"\n    }\n  ]\n} }}"
      },
      "id": "line-notify-family",
      "name": "Line: ê°€ì¡± ê·¸ë£¹ ì•Œë¦¼",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1120, 300],
      "credentials": {
        "httpHeaderAuth": {
          "id": "YOUR_LINE_CREDENTIAL_ID",
          "name": "Line Bot Auth"
        }
      }
    }
  ],
  "connections": {
    "Schedule: ì›”ìš”ì¼ 11ì‹œ": {
      "main": [
        [
          {
            "node": "Notion: ìµœì‹  ë ˆìŠ¨ ì¡°íšŒ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notion: ìµœì‹  ë ˆìŠ¨ ì¡°íšŒ": {
      "main": [
        [
          {
            "node": "Code: ë‹¤ìŒ íšŒì°¨ ê³„ì‚°",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code: ë‹¤ìŒ íšŒì°¨ ê³„ì‚°": {
      "main": [
        [
          {
            "node": "Notion: ìƒˆ ë ˆìŠ¨ í˜ì´ì§€ ìƒì„±",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notion: ìƒˆ ë ˆìŠ¨ í˜ì´ì§€ ìƒì„±": {
      "main": [
        [
          {
            "node": "Line: ê°€ì¡± ê·¸ë£¹ ì•Œë¦¼",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "timezone": "Asia/Bangkok"
  },
  "staticData": null,
  "tags": [
    {
      "name": "Golf Family"
    }
  ],
  "triggerCount": 1
}
