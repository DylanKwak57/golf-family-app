{
  "name": "WF3 - ë ˆìŠ¨ í™•ì¸ ìš”ì²­",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 14,
              "triggerAtMinute": 0
            }
          ]
        }
      },
      "id": "schedule-trigger",
      "name": "Schedule: ìˆ˜ìš”ì¼ 14ì‹œ",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [220, 300],
      "notes": "ë§¤ì£¼ ìˆ˜ìš”ì¼ 14:00 (ë°©ì½•ì‹œê°„)\n\nâš ï¸ ì„¤ì • í•„ìš”:\n- Mode: Every Week\n- Weekday: Wednesday\n- Hour: 14\n- Minute: 0\n- Timezone: Asia/Bangkok"
    },
    {
      "parameters": {
        "operation": "getAll",
        "databaseId": "0c5ee4b0-26ab-4f0a-9881-5453b072a0cb",
        "returnAll": false,
        "limit": 1,
        "filterType": "none",
        "sort": {
          "sortValue": [
            {
              "key": "ìˆ˜ì—… ë‚ ì§œ",
              "type": "timestamp",
              "direction": "descending"
            }
          ]
        },
        "options": {}
      },
      "id": "notion-get-lesson",
      "name": "Notion: ì´ë²ˆì£¼ ë ˆìŠ¨ ì¡°íšŒ",
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [440, 300],
      "credentials": {
        "notionApi": {
          "id": "notion-credential-id",
          "name": "Notion API"
        }
      },
      "notes": "ìµœì‹  ë ˆìŠ¨ í˜ì´ì§€ 1ê°œ ì¡°íšŒ\n\nì„¤ì •:\n- Database: Golf Lesson\n- Return All: OFF\n- Limit: 1\n- Sort: ìˆ˜ì—… ë‚ ì§œ Descending\n- Simplify: OFF"
    },
    {
      "parameters": {
        "jsCode": "// ì´ë²ˆì£¼ ë ˆìŠ¨ ë°ì´í„° ì²˜ë¦¬\nconst lesson = $input.first().json;\nconst props = lesson.properties;\n\n// ë‚ ì§œ íŒŒì‹±\nconst lessonDateStr = props['ìˆ˜ì—… ë‚ ì§œ']?.date?.start || '';\nconst lessonDate = new Date(lessonDateStr);\n\n// í•œêµ­ì–´ ìš”ì¼\nconst koDays = ['ì¼ìš”ì¼', 'ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼'];\nconst dayOfWeek = koDays[lessonDate.getDay()];\n\n// ë‚ ì§œ í¬ë§· (YYYY-MM-DD)\nconst formattedDate = `${lessonDate.getFullYear()}-${String(lessonDate.getMonth() + 1).padStart(2, '0')}-${String(lessonDate.getDate()).padStart(2, '0')}`;\n\n// ì¥ì†Œ\nconst location = props['ìˆ˜ì—… ì¥ì†Œ']?.select?.name || 'í¬íƒˆë¼ì´';\n\n// ìƒíƒœ í™•ì¸\nconst status = props['ìƒíƒœ']?.select?.name || 'ì •ìƒ';\n\n// íƒ€ì„ ë²ˆí˜¸\nconst bayNumber = props['íƒ€ì„ ë²ˆí˜¸']?.rich_text?.[0]?.plain_text || '';\n\n// íšŒì°¨\nconst session = props['íšŒì°¨ ']?.title?.[0]?.plain_text || '';\n\n// í™•ì¸ ìƒíƒœ\nconst kimProConfirm = props['ê¹€í”„ë¡œ í™•ì¸']?.checkbox || false;\nconst dylanConfirm = props['Dylan í™•ì¸']?.checkbox || false;\n\nreturn {\n  pageId: lesson.id,\n  session: session,\n  lessonDate: lessonDateStr,\n  formattedDate: formattedDate,\n  dayOfWeek: dayOfWeek,\n  location: location,\n  status: status,\n  bayNumber: bayNumber,\n  hasBayNumber: bayNumber.length > 0,\n  isNormal: status === 'ì •ìƒ',\n  kimProConfirm: kimProConfirm,\n  dylanConfirm: dylanConfirm\n};"
      },
      "id": "code-process",
      "name": "Code: ë ˆìŠ¨ ë°ì´í„° ì²˜ë¦¬",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [660, 300],
      "notes": "ë ˆìŠ¨ ë°ì´í„° íŒŒì‹±:\n- í•œêµ­ì–´ ìš”ì¼ ë³€í™˜\n- ìƒíƒœ í™•ì¸\n- íƒ€ì„ ë²ˆí˜¸ í™•ì¸\n- í™•ì¸ ìƒíƒœ í™•ì¸"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "condition-normal",
              "leftValue": "={{ $json.isNormal }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        }
      },
      "id": "if-check",
      "name": "IF: ìƒíƒœ ì •ìƒ?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [880, 300],
      "notes": "ì¡°ê±´ í™•ì¸:\n- ìƒíƒœ = ì •ìƒ\n\nì •ìƒì¼ ë•Œë§Œ í™•ì¸ ìš”ì²­ ë°œì†¡"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/push",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "lineNotifyApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ {\n  \"to\": \"U2168511c9cf9d66bb6cb0043f818bb1c\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\nğŸ“š ë‚´ì¼ ê³¨í”„ ë ˆìŠ¨ í™•ì¸\\n\\nğŸ“… \" + $json.dayOfWeek + \" (\" + $json.formattedDate + \")\\nâ° 17:00 - 19:00\\nğŸ“ \" + $json.location + ($json.hasBayNumber ? \"\\nğŸ¯ íƒ€ì„: \" + $json.bayNumber : \"\") + \"\\n\\nğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê³¨ë¦°ì´: DYLAN, JAEWOO, AEEY, JIWOO\\n\\nâœ… í™•ì¸í•˜ì‹œë©´ í´ë¦­:\\nğŸ‘‰ https://dylankwak57.github.io/golf-family-app/family.html\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"\n    }\n  ]\n} }}"
      },
      "id": "line-kimpro",
      "name": "Line: ê¹€í”„ë¡œ í™•ì¸ ìš”ì²­",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1100, 200],
      "credentials": {
        "httpHeaderAuth": {
          "id": "line-auth-id",
          "name": "Line Bot Auth"
        }
      },
      "notes": "ê¹€í”„ë¡œì—ê²Œ ë ˆìŠ¨ í™•ì¸ ìš”ì²­ ë°œì†¡\n\nâš ï¸ í…ŒìŠ¤íŠ¸ ì‹œ toë¥¼ Dylan IDë¡œ ë³€ê²½:\nU2168511c9cf9d66bb6cb0043f818bb1c\n\nìš´ì˜ ì‹œ ë³µì›:\nUb46e21fd3af428c831ffe3a1d3c23128"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/push",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "lineNotifyApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ {\n  \"to\": \"U2168511c9cf9d66bb6cb0043f818bb1c\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\nğŸ“š ë‚´ì¼ ê³¨í”„ ë ˆìŠ¨ í™•ì¸\\n\\nğŸ“… \" + $json.dayOfWeek + \" (\" + $json.formattedDate + \")\\nâ° 17:00 - 19:00\\nğŸ“ \" + $json.location + ($json.hasBayNumber ? \"\\nğŸ¯ íƒ€ì„: \" + $json.bayNumber : \"\") + \"\\n\\nğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê³¨ë¦°ì´: DYLAN, JAEWOO, AEEY, JIWOO\\n\\nâœ… í™•ì¸í•˜ì‹œë©´ í´ë¦­:\\nğŸ‘‰ https://dylankwak57.github.io/golf-family-app/family.html\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"\n    }\n  ]\n} }}"
      },
      "id": "line-dylan",
      "name": "Line: Dylan í™•ì¸ ìš”ì²­",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1100, 400],
      "credentials": {
        "httpHeaderAuth": {
          "id": "line-auth-id",
          "name": "Line Bot Auth"
        }
      },
      "notes": "Dylanì—ê²Œ ë ˆìŠ¨ í™•ì¸ ìš”ì²­ ë°œì†¡"
    },
    {
      "parameters": {},
      "id": "no-op",
      "name": "No Operation: ìŠ¤í‚µ",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [1100, 600],
      "notes": "ìƒíƒœê°€ 'ì •ìƒ'ì´ ì•„ë‹ ë•Œ:\n- ì·¨ì†Œ ë˜ëŠ” ë³€ê²½ ìƒíƒœ\n\nâ†’ í™•ì¸ ìš”ì²­ ë°œì†¡í•˜ì§€ ì•ŠìŒ"
    }
  ],
  "connections": {
    "Schedule: ìˆ˜ìš”ì¼ 14ì‹œ": {
      "main": [
        [
          {
            "node": "Notion: ì´ë²ˆì£¼ ë ˆìŠ¨ ì¡°íšŒ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notion: ì´ë²ˆì£¼ ë ˆìŠ¨ ì¡°íšŒ": {
      "main": [
        [
          {
            "node": "Code: ë ˆìŠ¨ ë°ì´í„° ì²˜ë¦¬",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code: ë ˆìŠ¨ ë°ì´í„° ì²˜ë¦¬": {
      "main": [
        [
          {
            "node": "IF: ìƒíƒœ ì •ìƒ?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF: ìƒíƒœ ì •ìƒ?": {
      "main": [
        [
          {
            "node": "Line: ê¹€í”„ë¡œ í™•ì¸ ìš”ì²­",
            "type": "main",
            "index": 0
          },
          {
            "node": "Line: Dylan í™•ì¸ ìš”ì²­",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation: ìŠ¤í‚µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "timezone": "Asia/Bangkok"
  },
  "tags": [
    {
      "name": "Golf Family"
    }
  ]
}
